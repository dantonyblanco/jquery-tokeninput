/*! jquery.tokeninput 2016-06-02 */
(function(a){var b={method:"GET",queryParam:"q",searchDelay:300,minChars:1,propertyToSearch:"name",jsonContainer:null,contentType:"json",excludeCurrent:false,excludeCurrentParameter:"x",prePopulate:null,processPrePopulate:false,hintText:"Type in a search term",noResultsText:"No results",searchingText:"Searching...",deleteText:"&#215;",animateDropdown:true,placeholder:null,theme:null,zindex:999,resultsLimit:null,enableHTML:false,resultsFormatter:function(a){var b=a[this.propertyToSearch];return"<li>"+(this.enableHTML?b:i(b))+"</li>"},tokenFormatter:function(a){var b=a[this.propertyToSearch];return"<li><p>"+(this.enableHTML?b:i(b))+"</p></li>"},tokenLimit:null,tokenDelimiter:",",preventDuplicates:false,tokenValue:"id",allowFreeTagging:false,allowTabOut:false,autoSelectFirstResult:false,onResult:null,onCachedResult:null,onAdd:null,onFreeTaggingAdd:null,onDelete:null,onReady:null,idPrefix:"token-input-",disabled:false};var c={tokenList:"token-input-list",token:"token-input-token",tokenReadOnly:"token-input-token-readonly",tokenDelete:"token-input-delete-token",selectedToken:"token-input-selected-token",highlightedToken:"token-input-highlighted-token",dropdown:"token-input-dropdown",dropdownItem:"token-input-dropdown-item",dropdownItem2:"token-input-dropdown-item2",selectedDropdownItem:"token-input-selected-dropdown-item",inputToken:"token-input-input-token",focused:"token-input-focused",disabled:"token-input-disabled"};var d={BEFORE:0,AFTER:1,END:2};var e={BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,NUMPAD_ENTER:108,COMMA:188};var f={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"};var g=/[&<>"'\/]/g;function h(a){return String(a===null||a===undefined?"":a)}function i(a){return h(a).replace(g,function(a){return f[a]})}var j={init:function(c,d){var e=a.extend({},b,d||{});return this.each(function(){a(this).data("settings",e);a(this).data("tokenInputObject",new a.TokenList(this,c,e))})},clear:function(){this.data("tokenInputObject").clear();return this},add:function(a){this.data("tokenInputObject").add(a);return this},remove:function(a){this.data("tokenInputObject").remove(a);return this},get:function(){return this.data("tokenInputObject").getTokens()},toggleDisabled:function(a){this.data("tokenInputObject").toggleDisabled(a);return this},setOptions:function(b){a(this).data("settings",a.extend({},a(this).data("settings"),b||{}));return this},destroy:function(){if(this.data("tokenInputObject")){this.data("tokenInputObject").clear();var a=this;var b=this.parent();b.empty();a.show();b.append(a);return a}}};a.fn.tokenInput=function(a){if(j[a]){return j[a].apply(this,Array.prototype.slice.call(arguments,1))}else{return j.init.apply(this,arguments)}};a.TokenList=function(b,f,g){if(typeof f==="string"){a(b).data("settings").url=f;var h=Y();if(a(b).data("settings").crossDomain===undefined&&typeof h==="string"){if(h.indexOf("://")===-1){a(b).data("settings").crossDomain=false}else{a(b).data("settings").crossDomain=location.href.split(/\/+/g)[1]!==h.split(/\/+/g)[1]}}}else if(typeof f==="function"){a(b).data("settings").callback=f}else if(typeof f==="object"){a(b).data("settings").local_data=f}if(a(b).data("settings").classes){a(b).data("settings").classes=a.extend({},c,a(b).data("settings").classes)}else if(a(b).data("settings").theme){a(b).data("settings").classes={};a.each(c,function(c,d){a(b).data("settings").classes[c]=d+"-"+a(b).data("settings").theme})}else{a(b).data("settings").classes=c}var j=[];var k=0;var l=new a.TokenList.Cache;var m;var n;var o=a('<input type="text" autocomplete="off" autocapitalize="off"/>').css({outline:"none"}).attr("id",a(b).data("settings").idPrefix+b.id).focus(function(){if(a(b).data("settings").disabled){return false}else if(a(b).data("settings").tokenLimit===null||a(b).data("settings").tokenLimit!==k){N()}t.addClass(a(b).data("settings").classes.focused)}).blur(function(){K();if(a(b).data("settings").allowFreeTagging){C()}a(this).val("");t.removeClass(a(b).data("settings").classes.focused)}).bind("keyup keydown blur update",B).keydown(function(c){var f;var g;switch(c.keyCode){case e.LEFT:case e.RIGHT:case e.UP:case e.DOWN:if(this.value.length===0){f=u.prev();g=u.next();if(f.length&&f.get(0)===q||g.length&&g.get(0)===q){if(c.keyCode===e.LEFT||c.keyCode===e.UP){G(a(q),d.BEFORE)}else{G(a(q),d.AFTER)}}else if((c.keyCode===e.LEFT||c.keyCode===e.UP)&&f.length){F(a(f.get(0)))}else if((c.keyCode===e.RIGHT||c.keyCode===e.DOWN)&&g.length){F(a(g.get(0)))}}else{var h=null;if(c.keyCode===e.DOWN||c.keyCode===e.RIGHT){h=a(v).find("li").first();if(s){h=a(s).next()}}else{h=a(v).find("li").last();if(s){h=a(s).prev()}}U(h)}break;case e.BACKSPACE:f=u.prev();if(this.value.length===0){if(q){I(a(q));p.change()}else if(f.length){F(a(f.get(0)))}return false}else if(a(this).val().length===1){K()}else{setTimeout(function(){W()},5)}break;case e.TAB:case e.ENTER:case e.NUMPAD_ENTER:case e.COMMA:if(s){E(a(s).data("tokeninput"));p.change()}else{if(a(b).data("settings").allowFreeTagging){if(a(b).data("settings").allowTabOut&&a(this).val()===""){return true}else{C()}}else{a(this).val("");if(a(b).data("settings").allowTabOut){return true}}c.stopPropagation();c.preventDefault()}return false;case e.ESCAPE:K();return true;default:if(String.fromCharCode(c.which)){setTimeout(function(){W()},5)}break}});if(g.placeholder){o.attr("placeholder",g.placeholder)}var p=a(b).hide().val("").focus(function(){Z(o)}).blur(function(){o.blur();return p});var q=null;var r=0;var s=null;var t=a("<ul />").addClass(a(b).data("settings").classes.tokenList).click(function(b){var c=a(b.target).closest("li");if(c&&c.get(0)&&a.data(c.get(0),"tokeninput")){H(c)}else{if(q){G(a(q),d.END)}Z(o)}}).mouseover(function(c){var d=a(c.target).closest("li");if(d&&q!==this){d.addClass(a(b).data("settings").classes.highlightedToken)}}).mouseout(function(c){var d=a(c.target).closest("li");if(d&&q!==this){d.removeClass(a(b).data("settings").classes.highlightedToken)}}).insertBefore(p);var u=a("<li />").addClass(a(b).data("settings").classes.inputToken).appendTo(t).append(o);var v=a("<div/>").addClass(a(b).data("settings").classes.dropdown).appendTo("body").hide();var w=a("<tester/>").insertAfter(o).css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:o.css("fontSize"),fontFamily:o.css("fontFamily"),fontWeight:o.css("fontWeight"),letterSpacing:o.css("letterSpacing"),whiteSpace:"nowrap"});p.val("");var x=a(b).data("settings").prePopulate||p.data("pre");if(a(b).data("settings").processPrePopulate&&a.isFunction(a(b).data("settings").onResult)){x=a(b).data("settings").onResult.call(p,x)}if(x&&x.length){a.each(x,function(a,b){D(b);A();o.attr("placeholder",null)})}if(a(b).data("settings").disabled){z(true)}if(typeof a(b).data("settings").onReady==="function"){a(b).data("settings").onReady.call()}this.clear=function(){t.children("li").each(function(){if(a(this).children("input").length===0){I(a(this))}})};this.add=function(a){E(a)};this.remove=function(b){t.children("li").each(function(){if(a(this).children("input").length===0){var c=a(this).data("tokeninput");var d=true;for(var e in b){if(b[e]!==c[e]){d=false;break}}if(d){I(a(this))}}})};this.getTokens=function(){return j};this.toggleDisabled=function(a){z(a)};B();function y(c){return a(b).data("settings").enableHTML?c:i(c)}function z(c){if(typeof c==="boolean"){a(b).data("settings").disabled=c}else{a(b).data("settings").disabled=!a(b).data("settings").disabled}o.attr("disabled",a(b).data("settings").disabled);t.toggleClass(a(b).data("settings").classes.disabled,a(b).data("settings").disabled);if(q){G(a(q),d.END)}p.attr("disabled",a(b).data("settings").disabled)}function A(){if(a(b).data("settings").tokenLimit!==null&&k>=a(b).data("settings").tokenLimit){o.hide();K();return}}function B(){if(n===(n=o.val())){return}var a=t.width()-o.offset().left-t.offset().left;w.html(i(n)||i(g.placeholder));o.width(Math.min(t.width(),Math.max(a,w.width()+30)))}function C(){var c=a.trim(o.val());var d=c.split(a(b).data("settings").tokenDelimiter);a.each(d,function(c,d){if(!d){return}if(a.isFunction(a(b).data("settings").onFreeTaggingAdd)){d=a(b).data("settings").onFreeTaggingAdd.call(p,d)}var e={};e[a(b).data("settings").tokenValue]=e[a(b).data("settings").propertyToSearch]=d;E(e)})}function D(c){var d=a(a(b).data("settings").tokenFormatter(c));var e=c.readonly===true;if(e)d.addClass(a(b).data("settings").classes.tokenReadOnly);d.addClass(a(b).data("settings").classes.token).insertBefore(u);if(!e){a("<span>"+a(b).data("settings").deleteText+"</span>").addClass(a(b).data("settings").classes.tokenDelete).appendTo(d).click(function(){if(!a(b).data("settings").disabled){I(a(this).parent());p.change();return false}})}var f=c;a.data(d.get(0),"tokeninput",c);j=j.slice(0,r).concat([f]).concat(j.slice(r));r++;J(j,p);k+=1;if(a(b).data("settings").tokenLimit!==null&&k>=a(b).data("settings").tokenLimit){o.hide();K()}return d}function E(c){var d=a(b).data("settings").onAdd;if(k>0&&a(b).data("settings").preventDuplicates){var e=null;t.children().each(function(){var b=a(this);var d=a.data(b.get(0),"tokeninput");if(d&&d[g.tokenValue]===c[g.tokenValue]){e=b;return false}});if(e){F(e);u.insertAfter(e);Z(o);return}}o.width(1);if(a(b).data("settings").tokenLimit==null||k<a(b).data("settings").tokenLimit){D(c);o.attr("placeholder",null);A()}o.val("");K();if(a.isFunction(d)){d.call(p,c)}}function F(c){if(!a(b).data("settings").disabled){c.addClass(a(b).data("settings").classes.selectedToken);q=c.get(0);o.val("");K()}}function G(c,e){c.removeClass(a(b).data("settings").classes.selectedToken);q=null;if(e===d.BEFORE){u.insertBefore(c);r--}else if(e===d.AFTER){u.insertAfter(c);r++}else{u.appendTo(t);r=k}Z(o)}function H(b){var c=q;if(q){G(a(q),d.END)}if(c===b.get(0)){G(b,d.END)}else{F(b)}}function I(c){var d=a.data(c.get(0),"tokeninput");var e=a(b).data("settings").onDelete;var f=c.prevAll().length;if(f>r)f--;c.remove();q=null;Z(o);j=j.slice(0,f).concat(j.slice(f+1));if(j.length==0){o.attr("placeholder",g.placeholder)}if(f<r)r--;J(j,p);k-=1;if(a(b).data("settings").tokenLimit!==null){o.show().val("");Z(o)}if(a.isFunction(e)){e.call(p,d)}}function J(c,d){var e=a.map(c,function(c){if(typeof a(b).data("settings").tokenValue=="function")return a(b).data("settings").tokenValue.call(this,c);return c[a(b).data("settings").tokenValue]});d.val(e.join(a(b).data("settings").tokenDelimiter))}function K(){v.hide().empty();s=null}function L(){v.css({position:"absolute",top:t.offset().top+t.outerHeight(true),left:t.offset().left,width:t.width(),"z-index":a(b).data("settings").zindex}).show()}function M(){if(a(b).data("settings").searchingText){v.html("<p>"+y(a(b).data("settings").searchingText)+"</p>");L()}}function N(){if(a(b).data("settings").hintText){v.html("<p>"+y(a(b).data("settings").hintText)+"</p>");L()}}var O=new RegExp("[.\\\\+*?\\[\\^\\]$(){}=!<>|:\\-]","g");function P(a){return a.replace(O,"\\$&")}function Q(a,b){return a.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+P(b)+")(?![^<>]*>)(?![^&;]+;)","gi"),function(a,b){return"<b>"+y(b)+"</b>"})}function R(a,b,c){return a.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+P(b)+")(?![^<>]*>)(?![^&;]+;)","g"),Q(b,c))}function S(c){if(a(b).data("settings").excludeCurrent){var d=a(b).data("tokenInputObject").getTokens(),e=[];if(d.length){a.each(c,function(c,f){var g=true;a.each(d,function(c,d){if(f[a(b).data("settings").propertyToSearch]==d[a(b).data("settings").propertyToSearch]){g=false;return false}});if(g){e.push(f)}});c=e}}return c}function T(c,d){d=S(d);if(d&&d.length){v.empty();var e=a("<ul/>").appendTo(v).mouseover(function(b){U(a(b.target).closest("li"))}).mousedown(function(b){E(a(b.target).closest("li").data("tokeninput"));p.change();return false}).hide();if(a(b).data("settings").resultsLimit&&d.length>a(b).data("settings").resultsLimit){d=d.slice(0,a(b).data("settings").resultsLimit)}a.each(d,function(d,f){var g=a(b).data("settings").resultsFormatter(f);g=R(g,f[a(b).data("settings").propertyToSearch],c);g=a(g).appendTo(e);if(d%2){g.addClass(a(b).data("settings").classes.dropdownItem)}else{g.addClass(a(b).data("settings").classes.dropdownItem2)}if(d===0&&a(b).data("settings").autoSelectFirstResult){U(g)}a.data(g.get(0),"tokeninput",f)});L();if(a(b).data("settings").animateDropdown){e.slideDown("fast")}else{e.show()}}else{if(a(b).data("settings").noResultsText){v.html("<p>"+y(a(b).data("settings").noResultsText)+"</p>");L()}}}function U(c){if(c){if(s){V(a(s))}c.addClass(a(b).data("settings").classes.selectedDropdownItem);s=c.get(0)}}function V(c){c.removeClass(a(b).data("settings").classes.selectedDropdownItem);s=null}function W(){var c=o.val();if(c&&c.length){if(q){G(a(q),d.AFTER)}if(c.length>=a(b).data("settings").minChars){M();clearTimeout(m);m=setTimeout(function(){X(c)},a(b).data("settings").searchDelay)}else{K()}}}function X(c){var d=c+Y();var e=l.get(d);if(e){if(a.isFunction(a(b).data("settings").onCachedResult)){e=a(b).data("settings").onCachedResult.call(p,e)}T(c,e)}else{if(a(b).data("settings").url){var f=Y();var h={};h.data={};if(f.indexOf("?")>-1){var i=f.split("?");h.url=i[0];var j=i[1].split("&");a.each(j,function(a,b){var c=b.split("=");h.data[c[0]]=c[1]})}else{h.url=f}h.data[a(b).data("settings").queryParam]=c;h.type=a(b).data("settings").method;h.dataType=a(b).data("settings").contentType;if(a(b).data("settings").crossDomain){h.dataType="jsonp"}if(a(b).data("settings").excludeCurrent){var k=a(b).data("tokenInputObject").getTokens();var m=a.map(k,function(c){if(typeof a(b).data("settings").tokenValue=="function")return a(b).data("settings").tokenValue.call(this,c);return c[a(b).data("settings").tokenValue]});h.data[a(b).data("settings").excludeCurrentParameter]=m.join(a(b).data("settings").tokenDelimiter)}h.success=function(e){l.add(d,a(b).data("settings").jsonContainer?e[a(b).data("settings").jsonContainer]:e);if(a.isFunction(a(b).data("settings").onResult)){e=a(b).data("settings").onResult.call(p,e)}if(o.val()===c){T(c,a(b).data("settings").jsonContainer?e[a(b).data("settings").jsonContainer]:e)}};if(g.onSend){g.onSend(h)}a.ajax(h)}else if(a(b).data("settings").local_data){var n=a.grep(a(b).data("settings").local_data,function(d){return d[a(b).data("settings").propertyToSearch].toLowerCase().indexOf(c.toLowerCase())>-1});l.add(d,n);if(a.isFunction(a(b).data("settings").onResult)){n=a(b).data("settings").onResult.call(p,n)}T(c,n)}else if(a(b).data("settings").callback){var q=function(){l.add(d,a(b).data("settings").jsonContainer?n[a(b).data("settings").jsonContainer]:n);if(a.isFunction(a(b).data("settings").onResult)){n=a(b).data("settings").onResult.call(p,n)}if(o.val()===c){T(c,a(b).data("settings").jsonContainer?n[a(b).data("settings").jsonContainer]:n)}};a(b).data("settings").callback(c,q)}}}function Y(){var c=a(b).data("settings");return typeof c.url=="function"?c.url.call(c):c.url}function Z(a){setTimeout(function(){a.focus()},50)}};a.TokenList.Cache=function(b){var c,d={},e=0,f;c=a.extend({max_size:500},b);f=function(){d={};e=0};this.add=function(a,b){if(e>c.max_size){f()}if(!d[a]){e+=1}d[a]=b};this.get=function(a){return d[a]}}})(jQuery);